#!/bin/sh
# vim:foldmethod=marker foldmarker={{{,}}} syntax=sh
# Local ----------------------------------------------------------------------- {{{
# I am french but I like using my software in English :
# We are going to set LANG=fr and LC_MESSAGES=en.
# This way the local setting are french (currency, etcâ€¦) but the messages are 
# in English.
if test "$(uname)" != "Darwin"; then
    export LANG=fr_FR.utf8
    export LC_MESSAGES=en_US.utf8
fi
# FIXME LANGUAGE seems to be the same as LC_MESSAGES. to confirm.
# }}}
# Load rc files function ------------------------------------------------------ {{{
load_rcfiles () {
    for rcfile in ${SH}/rc/*.{sh,${CSHELL}}; do
        . ${rcfile}
    done
}
# }}}
# SSH agent ------------------------------------------------------------------- {{{
SSH_ENV=$HOME/.ssh/environment
start_agent () {
    # echo "Initialising new SSH agent..."
    # /usr/bin/ssh-agent | sed 's/^echo/#echo/' >! ${SSH_ENV}
    # chmod 600 ${SSH_ENV}
    #. ${SSH_ENV} > /dev/null
    if test -n "`ps -e|grep ssh-agent`"; then
        echo ""
    else
        eval `ssh-agent`
        /usr/bin/ssh-add;
    fi
}
if test `id -u` != 0; then
    KEYCHAIN="/usr/bin/keychain"
    if test -f /usr/local/bin/keychain; then
        KEYCHAIN="/usr/local/bin/keychain"
    elif test -f /usr/pkg/bin/keychain; then
        KEYCHAIN="/usr/pkg/bin/keychain"
    fi
    # Source SSH settings, if applicable
    if test -x "${KEYCHAIN}"
    then
        eval `${KEYCHAIN} --eval id_rsa`
    elif test -f "${SSH_ENV}"
    then
        . ${SSH_ENV} > /dev/null
        ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent > /dev/null || {
            start_agent;
        }
    else
        start_agent;
    fi
fi
# }}}

